!function(m,t){function e(t,e){return this.elem=t,this.FC=m(t),this.now=new Date,this.eventsCache={},this.ui={},this.metadata=this.FC.data("hh-calendar-options"),"string"==typeof this.metadata&&(this.metadata={}),this.options=m.extend(!0,{},a,e,this.metadata),this.ui.hasActiveEventPopover=!1,this.ui.eventPopover=m("<a></a>").css({position:"absolute",zindex:"9999"}).appendTo("body"),this.init(),this.initPubSub(),m.proxy(this.options.onReady,this)(),this}var a={categories:{},fullcalendar:{firstHour:9,header:{left:"prev,next today",center:"title",right:"month,listWeek,listDay"},slotMinutes:30,theme:!1,views:{listWeek:{buttonText:"week"},listDay:{buttonText:"day"}},defaultView:"month"},onReady:function(){},recurringPathArray:[],yyyyMMPathMap:{}};e.prototype.init=function(){var y=this,e=moment(y.now),t=m.extend(!0,{googleCalendarApiKey:y.options.googleCalendarApiKey,eventRender:function(t,e){t.target&&e.attr("target","_parent")},eventClick:function(t,e,a){var i="",n=moment(t.start),r=null!==t.end?moment(t.end):null,e=(e.preventDefault(),e.stopPropagation(),y.ui.hasActiveEventPopover?(y.ui.eventPopover.popover("dispose"),y.ui.hasActiveEventPopover=!1,y.ui.eventPopover.remove(),y.ui.eventPopover=m("<a></a>").css({position:"absolute",zindex:"9999",top:e.pageY,left:e.pageX}).appendTo("body")):y.ui.eventPopover.css({top:e.pageY,left:e.pageX}),t.allDay?(i=n.format("ddd, MMMM D"),i+=null!==r?r.isSame(n,"d")?"":" - "+r.format("ddd, MMMM D"):" - All Day"):(i=n.format("ddd, MMMM D, h:mma"),null!==r&&(i=(i+=" - ")+(r.isSame(n,"d")?r.format("h:mma"):r.format("ddd, MMMM D, h:mma")))),!1===t.url.includes("google.com")?'<p class="pull-right"><a href="'+t.url+'"'+(t.target?' target="_parent"':"")+'>view event <i class="fa-solid fa-angles-right"></i></a></p>':"<p>&nbsp;</p>");console.log(e),n='<ul><li><strong>When:</strong> <span class="event-date">'+i+"</span></li>"+(t.location&&"<li><strong>Where:</strong> "+t.location+"</li>"||"")+(t.summary&&"<li>"+t.summary+"</li>"||"")+"</ul>"+e,y.ui.eventPopover.popover({title:'<div class="d-flex justify-content-between">'+t.title+'<a class="close" data-dismiss="popover" style="line-height:14px; float: right;"><span class=""><i class="fa-solid fa-xmark"></i></span></a></div>',content:n,trigger:"manual",placement:"top",html:!0}).popover("show"),y.ui.hasActiveEventPopover=!0},viewRender:function(t){t=t.start.year();y.preserveCategories(),t!=e.year()&&(m(this).fullCalendar("rerenderEvents"),e.year(t))},eventAfterAllRender:function(t){y.preserveCategories()}},this.options.fullcalendar);y.FC.fullCalendar(t),m("html").click(function(){y.ui.eventPopover.popover("hide")}),y.FC.fullCalendar("addEventSource",function(t,e,a,i){for(var n=1,r=t.year(),o=e.year(),s=e.month()+1,l=[],c=null,d=function(){var t=m(this).parent(),e=[],a=m.trim(m("path",t).text()),i="true"===m.trim(m("allday",t).text());if("Once"!==m("frequency",t).text())return!0;m("category",t).each(function(){var t=m.trim(m(this).text()),t=y._getCategoryCSSClass(t);t&&-1===m.inArray(t,e)&&e.push(t)}),0<e.length&&(e.reverse(),!0!=i?(e.push("fixedtime"),c.push({id:m("id",t).text(),title:m("title",t).text(),summary:m("summary",t).text(),location:m("location",t).text(),url:a,start:m("startISO",t).text(),end:m("endISO",t).text(),target:"true"===m.trim(m("target",t).text()),allDay:!1,className:e})):c.push({id:m("id",t).text(),title:m("title",t).text(),summary:m("summary",t).text(),location:m("location",t).text(),url:a,start:m("startISO",t).text(),target:"true"===m.trim(m("target",t).text()),allDay:!0,className:e}))};r<o+1||n<=s&&r===o;){var h=r+(n<10?"0":"")+n,u=y.options.yyyyMMPathMap[h]||"";null===(c=y.eventsCache[h]||null)&&(c=[],""!==u&&m.ajax({url:u.replace(/\&amp\;/g,"&"),datatype:"xml",async:!1,success:function(t){m("path",t).each(d)}}),y.eventsCache[h]=c),0<c.length&&(l=l.concat(c)),n++,r+=Math.floor(n/13),n%=13}i(l)}),y.FC.fullCalendar("addEventSource",function(t,e,a,i){function f(t,e,a,i){r.push({id:t.id,title:t.title,summary:t.summary,location:t.location,url:t.url,start:e,end:a,target:t.target,allDay:t.allDay,className:t.className})}var n=0,r=(new Date,y.eventsCache.recurringEvents),g={Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6};if(theDate=moment(),null==r||r.length<=0){for(r=[];n<y.options.recurringPathArray.length;n++){var o=y.options.recurringPathArray[n];null!=o&&(o=o.replace(/\&amp\;/g,"&"),m.ajax({url:o,datatype:"xml",async:!1,success:function(t){m("path",t).each(function(){var t=m(this).parent(),e=[],a=m("frequency",t).text(),i=parseInt(m("interval",t).text());if("Once"===a)return!0;if(m("category",t).each(function(){var t=m.trim(m(this).text()),t=y._getCategoryCSSClass(t);t&&-1===m.inArray(t,e)&&e.push(t)}),0<e.length){e.reverse();var n="true"===m.trim(m("allday",t).text()),r={id:m("id",t).text(),title:m("title",t).text(),summary:m("summary",t).text(),location:m("location",t).text(),url:m.trim(m("path",t).text()),target:"true"===m.trim(m("target",t).text()),allDay:n,className:e},o=moment.utc(m("startISO",t).text()),s=moment.utc(m("endISO",t).text()),l=moment.utc(m("untilISO",t).text()),c=s.diff(o,"s"),d=o.clone();switch(!0!=n&&r.className.push("fixedtime"),!1===l.isValid()?l=o.clone().add("y",2):2<l.diff(o,"y")&&l.years(o.years()+2),a){case"Daily":for(;0<=l.diff(o,"s");)f(r,o.toISOString(),s.toISOString()),o.add("d",i),s.add("d",i);break;case"Weekly":if((days=m("day",t)).length<1)for(;0<=l.diff(o,"s");)f(r,o.toISOString(),s.toISOString()),o.add("w",i),s.add("w",i);else for(;0<=l.diff(o,"s");)days.each(function(){o.date(o.date()+(g[m(this).text()]-o.day())),s=o.clone().add("s",c),0<=o.diff(d,"s")&&f(r,o.toISOString(),s.toISOString())}),o.add("w",i),s.add("w",i);break;case"Monthly":if("day of the month"==(dayOfMonthOption=m("monthly-day",t).text()))for(;0<=l.diff(o,"s");)o.date()==d.date()&&f(r,o.toISOString(),s.toISOString()),o.add("M",i),o.daysInMonth()>=d.date()&&o.date(d.date()),s=o.clone().add("s",c);else for(var h=Math.floor(o.date()/7),u=o.day()+1,p=o.month();0<=l.diff(o,"s");)p===o.month()&&f(r,o.toISOString(),s.toISOString()),o.add("M",i).date(1),p=o.month(),u<=o.day()?o.date(u-o.day()+7*(h+1)):o.date(u-o.day()+7*h),s=o.clone().add("s",c);break;case"Yearly":for(;0<=l.diff(o,"s");)f(r,o.toISOString(),s.toISOString()),o.add("y",i),s.add("y",i)}}})}}))}0<r.length&&(y.eventsCache.recurringEvents=r)}i(r)})},e.prototype.subscribe=function(t,e){this.events.subscribe(t,m.proxy(e,this))},e.prototype.getOption=function(t){-1!==t.indexOf("options.")&&(t=t.replace("options.",""));var a=this.options,t=t.split("."),e=t.pop(),i=null;return 0===t.length?a[e]:(m.each(t,function(t,e){i=a[e]}),void 0!==i?i[e]:null)},e.prototype.initPubSub=function(){var a=this;a.events={cache:{},publish:function(t,e){this.cache[t]&&("array"!=typeof e&&(e=[e]),m.each(this.cache[t],function(){try{this.apply(a,e||[])}catch(t){console.log(t)}}))},subscribe:function(t,e){return this.cache[t]||(this.cache[t]=[]),this.cache[t].push(e),[t,e]},unsubscribe:function(e,a){var i=this;i.cache[e]&&m.each(i.cache[e],function(t){this==a&&i.cache[e].splice(t,1)})},subscribers:function(t){return l=[],this.cache[t]&&m.each(this.cache[t],function(t){l.push(this.name)}),l}}},e.prototype.preserveCategories=function(){m("#calendars a").each(function(){var t=m(this).attr("id").replace("trigger-",""),e=m(this).hasClass("off"),a=m("#calendar ."+t);e&&(a.addClass(t+"-off"),a.removeClass(t))})},e.prototype.renderCategoryOptions=function(t){var e=this,a="",i=t instanceof jQuery?t:m(t);a+="<ul id='categories' class='unstyled'>",m.each(e.options.categories,function(t,e){a+='<li><a id="trigger-'+e+'" href="#"> <span> </span>'+t.replace(/_/g," ")+"</a></li>"}),a+='</ul><div class="btn-group" style="margin-bottom: 20px;"><a class="btn btn-primary" href="#" id="categoriesToggleHide" title="Hide all events">Hide All</a><a class="btn btn-primary" href="#" id="categoriesToggleShow" title="Show all events">Show All</a></div>',i.html(a),m("a[id^='trigger-']",i).click(function(){var t=m(this).attr("id").replace("trigger-","");return e.toggleEventsInCategory(t,m(this).hasClass("off")),m(this).toggleClass("off"),!1}),m("#categoriesToggleHide").click(function(){return m("a[id^='trigger-']",i).each(function(){var t=m(this).attr("id").replace("trigger-","");m(this).addClass("off"),e.toggleEventsInCategory(t,!1)}),!1}),m("#categoriesToggleShow").click(function(t){return m("a[id^='trigger-']",i).each(function(){var t=m(this).attr("id").replace("trigger-","");m(this).removeClass("off"),e.toggleEventsInCategory(t,!0)}),!1})},e.prototype.toggleEventsInCategory=function(t,e){var a=m("#calendar ."+t+((e=e||!1)?"-off":""));e?(a.addClass(t),a.removeClass(t+"-off")):(a.addClass(t+"-off"),a.removeClass(t))},e.prototype.updateOption=function(t,e){-1===t.indexOf("options.")&&(t="options."+t),this.events.publish(t,[e])},e.prototype.updateOptions=function(t){var a=this;"object"==typeof t&&m.each(t,function(t,e){a.updateOption(t,e)})},e.prototype._getCategoryCSSClass=function(t){return this.options.categories[t.replace(/\s/g,"_")]||!1},t.Calendar=e,m.fn.hhCalendar=function(t){return this.each(function(){m.data(this,"hh-calendar")||m.data(this,"hh-calendar",new e(m(this),t))})}}(jQuery,this);